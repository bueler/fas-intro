\documentclass[letterpaper,final,12pt,reqno]{amsart}

\usepackage[total={6.3in,9.2in},top=1.1in,left=1.1in]{geometry}

\usepackage{times,bm,bbm,empheq,fancyvrb,graphicx}
\usepackage[dvipsnames]{xcolor}
\usepackage{longtable}
\usepackage{booktabs}

\usepackage{tikz}
\usetikzlibrary{decorations.pathreplacing}

\usepackage[kw]{pseudo}
\pseudoset{left-margin=15mm,topsep=5mm,idfont=\texttt}

% hyperref should be the last package we load
\usepackage[pdftex,
colorlinks=true,
plainpages=false, % only if colorlinks=true
linkcolor=blue,   % ...
citecolor=Red,    % ...
urlcolor=black    % ...
]{hyperref}

\renewcommand{\baselinestretch}{1.05}

\newtheoremstyle{claim}% name
  {5pt}% space above
  {5pt}% space below
  {\itshape}% body font
  {}% indent amount
  {\itshape}% theorem head font
  {.}% punctuation after theorem head
  {.5em}% space after theorem head
  {\thmname{#1}\thmnumber{ #2}\thmnote{ (#3)}}% theorem head spec
\theoremstyle{claim}
\newtheorem{theorem}{Theorem}
\newtheorem{lemma}{Lemma}

\newcommand{\eps}{\epsilon}
\newcommand{\RR}{\mathbb{R}}

\newcommand{\grad}{\nabla}
\newcommand{\Div}{\nabla\cdot}
\newcommand{\trace}{\operatorname{tr}}

\newcommand{\hbn}{\hat{\mathbf{n}}}

\newcommand{\bb}{\mathbf{b}}
\newcommand{\be}{\mathbf{e}}
\newcommand{\bbf}{\mathbf{f}}
\newcommand{\bg}{\mathbf{g}}
\newcommand{\bn}{\mathbf{n}}
\newcommand{\br}{\mathbf{r}}
\newcommand{\bu}{\mathbf{u}}
\newcommand{\bv}{\mathbf{v}}
\newcommand{\bw}{\mathbf{w}}
\newcommand{\bx}{\mathbf{x}}

\newcommand{\bF}{\mathbf{F}}
\newcommand{\bV}{\mathbf{V}}
\newcommand{\bX}{\mathbf{X}}

\newcommand{\bxi}{\bm{\xi}}

\newcommand{\bzero}{\bm{0}}

\newcommand{\rhoi}{\rho_{\text{i}}}

\newcommand{\ip}[2]{\left<#1,#2\right>}

\newcommand{\mR}{R^{\bm{\oplus}}}
\newcommand{\iR}{R^{\bullet}}

\newcommand{\pp}{{\text{p}}}
\newcommand{\qq}{{\text{q}}}
\newcommand{\rr}{{\text{r}}}

% numbering
\setcounter{tocdepth}{3}
\makeatletter
\def\l@subsection{\@tocline{2}{0pt}{4pc}{5pc}{}}
\makeatother

\numberwithin{equation}{section}
\numberwithin{figure}{section}
\numberwithin{table}{section}
\numberwithin{theorem}{section}


\begin{document}
\title[Multilevel computation of glacier geometry from Stokes dynamics]{Multilevel computation of glacier geometry \\ from Stokes dynamics}

\author{Ed Bueler}

\author{Lawrence Mitchell}

\begin{abstract} FIXME MCD for steady and evolving geometry with Glen-Stokes dynamics
\end{abstract}

\maketitle

%\tableofcontents

\thispagestyle{empty}
%\bigskip

\section{Introduction} \label{sec:intro}

FIXME MCD = multilevel constraint decomposition, a multigrid \cite{Trottenbergetal2001} method basically by \cite{Tai2003} for obstacle problems; see part I \cite{Bueler2022};  obstacle problem view first extended to Stokes by \cite{WirbelJarosch2020}


\section{The steady ice geometry problem} \label{sec:stokesgeometry}

The standard model for determining the geometry of glaciers is based upon a shear-thinning version of the Stokes equations, namely the Glen-Stokes ice-dynamics model which we describe in this section, plus the surface kinematical equation (SKE).  We first state the strong form for this ``coupled'' glacier geometry model in the steady-state case, which we call the steady ice geometry problem (SIGP).  The emphasis here is on its complementarity-problem meaning, something often not stated in the standard glaciers literature (as observed by \cite{SchoofHewitt2013}).  We then define a weak form for the SIGP, noting along the way the theoretical unknowns of this problem.  Lastly in this section we extend the weak form to an implicit time-discretized evolving-geometry model, the implicit ice geometry problem (IIGP), a straightforward extension of the SIGP.

The problem is defined on a fixed, bounded map-plane region $\Omega \subset \RR^d$ (Figure \ref{fig:stokesdomain}) with map-plane variables $x$ when $d=1$ or $x,y$ when $d=2$.  On $\Omega$ we assume that a climatic mass balance (CMB) function $a(x,y)$ is defined at every point, whether or not ice is present at that location, with units of ice thickness (distance) per time, equivalently ice volume per area in $\Omega$ per time.  Similarly we assume there is a bed elevation function $b(x,y)$ defined everywhere on $\Omega$, with units of distance.  The functions $a$ and $b$ are the data of the SIGP.

\begin{figure}[t]
\begin{center}
\includegraphics[width=0.75\textwidth]{genfigs/stokesdomain.pdf}
\end{center}
\caption{The CMB $a(x,y)$ (arrows) and bed elevation $b(x,y)$ (solid) are given data on a fixed $d$-dimensional map-plane region $\Omega$.  The solution geometry defines a surface elevation $s(x,y)$ (dashed) on $\Omega$ and a $(d+1)$-dimensional icy domain $\Lambda_s = \{b(x,y) < z < s(x,y)\}$; note $s=b$ where ice-free.}
\label{fig:stokesdomain}
\end{figure}

By contrast, the stress balance for ice only applies in the interior of the icy domain.  We make a strong, but common \cite[for example]{IsaacStadlerGhattas2015,Jouvetetal2008,Lengetal2012,WirbelJarosch2020} assumption this this icy domain has a well-defined upper surface elevation, a function $s(x,y)$, that is, we assume there are \emph{no overhangs}.  We then define $s$ everywhere in $\Omega$ by extending with $s=b$ where ice is absent, thus $s\ge b$ applies on $\Omega$.  Note that $s(x,y)$ is part of the model solution; it is not given data.  However, as a consequence of this assumption the SIGP as described here is likely not to be well-posed because of an issue at the ice margin.  That is, there may be no steady state because the fluid geometry in the vicinity of a steep ice margin, especially on a steep bed feature, ``wants'' to generate an overhang, violating the well-defined-$s(x,y)$ assumption.  Furthermore the same concern applies to each time step of an evolving model in the sense that overhanging ice may appear at the margin.  However, essentially all modeling literature ignores this possibility and assumes well-defined surface elevation and thickness \cite{Jouvetetal2008,Lengetal2012,WirbelJarosch2020}, presumably because the overhang is small for all realistic data.  An exceptional model is by \cite{PralongFunk2005}, who also suggest a potentially well-posed extended continuum model, namely one in which serac and ice-cliff calving occurs via a damage variable and a stress-fracture failure criterion.  This extended model, which we do not pursue, relates to one of our numerical boundary variants, which implies a short cliff (Section \ref{sec:mcdstokes}), but in any case no overhang is allowed in any of our numerical constructions.

Based on this assumption of a well-defined upper surface, we define the $(d+1)$-dimensional (solution) extent of the ice as the open set
\begin{equation}
\Lambda_s = \{(x,y,z)\,|\,(x,y) \in \Omega \text{ and } b(x,y) < z < s(x,y)\} \label{eq:lambdas}
\end{equation}
where $z$ is vertically-upward.  Note that if $d=1$ then the coordinates on $\Lambda_s$ are denoted $(x,z)$.  The map-plane region $\Omega$ need not be connected or simply-connected, but even if $\Omega$ is topologically trivial the set $\Lambda_s$ need not be.  However, $\Lambda_s$ has the topology of the product of an open subset of $\Omega$ and a single interval, and it is numerically approximated by an extruded mesh (Section \ref{sec:mcdstokes}).

The dynamics of glaciers is based upon an assumption that ice is a very-viscous non-Newtonian fluid subject to Glen's shear-thinning flow law \cite{GreveBlatter2009}; see also \cite[Chapter 1]{FowlerNg2021}.  Allowing any Glen exponent $n\ge 1$, the equations for bulk ice, i.e.~in $\Lambda_s$, are
\begin{align}
- \nabla \cdot \tau + \nabla p &= \rhoi \bg &&\text{\emph{stress balance}} \label{eq:forcebalance} \\
\nabla \cdot \bu &= 0 &&\text{\emph{incompressibility}} \label{eq:incompressible} \\
\tau &= B_n |D\bu|^{(1/n) - 1} D\bu  &&\text{\emph{flow law}} \label{eq:viscflowlaw}
\end{align}
The solution fields are the velocity $\bu$, pressure $p$, and deviatoric stress $\tau$.  Regarding tensors and their notation, the (Cauchy) stress tensor $\sigma$ decomposes into the deviatoric part $\tau$ minus the pressure, i.e.~$\sigma = \tau - p\,I$, so equation \eqref{eq:forcebalance} simply says $-\Div \sigma = \rhoi \bg$.  The strain rate tensor $D\bu$ is the symmetric part of $\grad \bu$: \,$D\bu = \frac{1}{2} \left(\grad\bu + \grad\bu^\top\right)$.  Because $D\bu$ is symmetric, and because it has trace zero by equation \eqref{eq:incompressible}, i.e.~$\trace(D\bu)=\nabla \cdot \bu = 0$, from equation \eqref{eq:viscflowlaw} it follows that $\tau$ is also symmetric with trace zero, thus that $p=-(d+1)^{-1} \trace \sigma$.  The tensor norm used in \eqref{eq:viscflowlaw} satisfies $|D\bu|^2 = \frac{1}{2} (D\bu)_{ij} (D\bu)_{ij}$.  Regarding constants, in computations we will use $n=3$, ice density $\rhoi=910 \,\text{kg}\,\text{m}^{-3}$, and gravity $\bg=\left<0,0,-g\right>$, with $g=9.81\,\text{m}\,\text{s}^{-2}$.  Also $B_n$ is the $n$-dependent ice hardness, with $B_3=6.8082\times 10^7\,\text{Pa}\,\text{s}^{1/3}$ used in computations; this is a constant because we assume isothermal conditions \cite{GreveBlatter2009}.

For the $n=1$ linear Stokes equations one would write \eqref{eq:viscflowlaw} as $\tau = 2\nu D\bu$ with viscosity $\nu$ \cite[for example]{Elmanetal2014}.  For powers $n>1$, namely shear-thinning ice we instead define an effective viscosity function using a negative power of the strain rate norm $|D\bu|$.  The effective viscosity for \eqref{eq:viscflowlaw} would be singular in the limit of small strain rates, and so, motivated by the actual finite viscosity of glacier ice \cite{GreveBlatter2009}, we define the regularized effective viscosity
\begin{equation}
\nu_\eps = \frac{1}{2} B_n \left(|D\bu|^2 + \eps\, D_0^2\right)^{(\pp-2)/2}, \label{eq:regeffvisc}
\end{equation}
where $\pp=(1/n)+1(=4/3)$.  The constant $D_0$ defines a strain-rate scale for glacier flow; $D_0 = 1 \,\text{a}^{-1}$ and $\eps = 10^{-4}$ are used in computations.  Finally, we may also eliminate $\tau$ and rewrite \eqref{eq:forcebalance} as $- \nabla \cdot \left(2 \nu_\eps\, D\bu\right) + \nabla p = \rhoi \mathbf{g}$.

We apply dynamic boundary conditions for isolated, grounded, and non-sliding glaciers and ice sheets.  In addition to the already-stated assumption that the top and bottom boundaries of $\Lambda_s$ can be identified, we further assume these surfaces have well-defined tangents.  On top we set a condition of zero applied stress,
\begin{equation}
\left(2 \nu_\eps D\bu - pI\right) \bn_s = \bzero  \qquad \qquad \text{\emph{on the top} } \overline{\partial} \Lambda_s \label{eq:topbc}
\end{equation}
where $\bn_s$ is any normal to the ice surface.  (If desired it is straightforward to provide a nonzero atmospheric pressure at the surface.)  On the base we impose no slip:
\begin{equation}
\bu = \bzero  \qquad\qquad \text{\emph{on the base} } \underline{\partial} \Lambda_s. \label{eq:basebc}
\end{equation}
The ice flow extends in the horizontal direction until a free boundary at the glacier margin is reached.  The surface gradient $\grad s$ may becomes singular at these locations, but the top and bottom surfaces are assumed to meet at the margin (Figure \ref{fig:stokesdomain}).  Real glacier margins may occur as fracture-generated cliffs \cite{PralongFunk2005}, but the non-fluid processes which generate such cliffs are not modeled here.

The well-posedness of the above dynamics model is proven by \cite{JouvetRappaz2011}, and the solution is a unique pair $(\bu,p)$ defined on $\Lambda_s$.  We identify the relevant function spaces below, when stating the weak formulation of the SIGP.

\newcommand{\bus}{\bu|_s}

However, the simultaneous determination of $\Lambda_s$ and $\bu$ is the goal of the SIGP model.  Noting the above equations make no reference to the CMB function $a$, we need an ``equation'' which combines the climate and the ice flow, but we will see that this is actually an inequality.  For this purpose, noting that the surface elevation is already defined on all of $\Omega$, with $s=b$ off the ice, we also extend the surface normal $\bn_s$, thus formula
\begin{equation}
\bn_s = \left<-s_x,-s_y,1\right> \label{eq:surfacenormal}
\end{equation}
is now valid on all of $\Omega$ where $s(x,y)$ has a well-defined gradient.  (By contrast, note that the dynamical boundary condition \eqref{eq:topbc} applies only on top of the ice.)  Furthermore we extend the surface value of the velocity to all of $\Omega$:
\begin{equation}
\bus = \begin{cases} \bu(x,y,s(x,y)), & s(x,y) > b(x,y), \\
                     \bzero, & \text{elsewhere}. \end{cases} \label{eq:surfacevelocity}
\end{equation}
(The movement of the solid earth would allow $\bus\ne 0$ anywhere in $\Omega$, and a more complete model could include this small effect.)  The steady-state surface kinematical equation (SKE) \cite[see equation (5.21)]{GreveBlatter2009} is an aspect of mass conservation:
\begin{equation}
\bus \cdot \bn_s + a = 0 \qquad \text{\emph{on the ice}}. \label{eq:ske}
\end{equation}
Note that $a(x,y)$ is the ice thickness added per unit area of the map-plane region $\Omega$ (per time), not per unit area of the ice surface \cite[compare]{GreveBlatter2009}.  (The latter quantity is significantly different if the gradient $\grad s$ is large.)  While the quantities in \eqref{eq:ske} are defined everywhere, the kinematical quantity $\bus \cdot \bn_s + a$ is only zero on the ice.  With convention \eqref{eq:surfacevelocity}, $\bus \cdot \bn_s + a \le 0$ everywhere because $a$ is nonpositive in steady state in ice-free locations.

In fact, when combined with the constraint that $s\ge b$ everywhere on $\Omega$, SKE \eqref{eq:ske} is part of a nonlinear complementarity problem (NCP).  An NCP on a finite-dimensional vector space $V=\RR^k$ combines the three statements $x\ge 0$, $F(x)\ge 0$, and $x F(x)=0$, where $F:V\to V$ \cite{FacchineiPang2003}.  This leads us to state a strong form of the SIGP as follows:
\begin{align}
s - b &\ge 0 && \text{on $\Omega$} \label{eq:strongform} \\
- \bu|_s \cdot \bn_s - a &\ge 0 && \text{\emph{same}} \notag \\
(s - b) (- \bu|_s \cdot \bn_s - a) &= 0 && \text{\emph{same}} \notag \\
- \nabla \cdot \left(2 \nu_\eps\, D\bu\right) + \nabla p - \rhoi \mathbf{g} &= \bzero && \text{on $\Lambda_s$} \notag \\
\nabla \cdot \bu &= 0 && \text{\emph{same}} \notag \\
\left(2 \nu_\eps D\bu - pI\right) \bn_s &= \bzero && \text{on $\overline{\partial} \Lambda_s$} \notag \\
\bu &= \bzero && \text{on $\underline{\partial} \Lambda_s$} \notag
\end{align}
(Note that definition \eqref{eq:regeffvisc} is also needed.)  The first three statements in \eqref{eq:strongform} form an infinite-dimensional NCP, but they are coupled to a dynamical boundary value problem, namely the last four statements.

The solution of \eqref{eq:strongform} is a triple of functions $s(x,y)$, $\bu(x,y,z)$, $p(x,y,z)$.  However, as the domain $\Lambda_s$ on which $\bu,p$ are defined is only known with the solution elevation $s$, \eqref{eq:strongform} is at best an incomplete description.  In fact, this inequality-constrained system of PDEs has a largely-unknown theory regarding well-posedness and solution regularity.  (Certain well-posedness theory is known for the SIA version of this problem, with existence established by \cite{JouvetBueler2012}, and uniqueness in the flat bed case.)  Nonetheless we will write it weak form, identifying reasonable function spaces and making solution existence credible, and solve it numerically.  As noted in the Introduction, numerical solutions usually apply explicit time-stepping to approach steady state, splitting the dynamics and the SKE into sub-steps and using truncation to address the NCP \cite[for example]{Jouvetetal2008,Lengetal2012}.  The weak form stated next, using a Stokes solution operator (Sections \ref{sec:weakido} and \ref{sec:deriv}), will address this concern.  Then in Section \ref{sec:mcdstokes} we will demonstrate a reasonably-robust multilevel scheme for the numerical solution of \eqref{eq:strongform}.


\section{Weak form and the ice dynamics operator} \label{sec:weakido}

Recall that the weak form of a PDE states that a certain functional, constructed by multiplying by a test function and integrating by parts, is zero.  Both the solution and the test functions come from identified function spaces, namely Sobolev spaces \cite{Evans2010}, and here we denote by $W^{k,r}$ the Sobolev space of functions on which have $k$ derivatives which are $r$th-power integrable.

The weak form of the fixed-geometry Glen-Stokes model for ice, which extends the better-known linear Stokes weak form \cite{Elmanetal2014} to regularized power-law rheology, is relatively well-known \cite{IsaacStadlerGhattas2015,JouvetRappaz2011,Lengetal2012}, and we summarize it here.  Suppose that $\Lambda \subset \RR^{d+1}$ is fixed domain on which we prescribe a Dirchlet condition $\bu=0$ on a portion of the boundary, and where the remainder of the boundary (Neumann boundary) is stress-free.  Let $\pp=(1/n)+1$ as before, and let $\qq=(1-\pp^{-1})^{-1}=n+1$ be the conjugate exponent, so that $\pp^{-1}+\qq^{-1}=1$. (Note $\pp=4/3$ and $\qq = 4$ if $n=3$.)  Let $W_0^{1,\pp}(\Lambda)^{d+1}$ be the space of velocity functions which are zero along the Dirichlet boundary.  Let
\begin{equation}
\mathcal{M}_{\text{GS}} = W_0^{1,\pp}(\Lambda)^{d+1} \times L^\qq(\Lambda)  \label{eq:mixed}
\end{equation}
be the (mixed) space of admissible velocity and pressure pairs.  The Glen-Stokes weak form is the statement that $(\bu,p) \in \mathcal{M}_{\text{GS}}$ should satisfy
\begin{equation}
F_{\text{GS}}(\bu,p)[\bv,q] = \int_\Lambda 2 \nu_\eps D\bu : D\bv - p \Div\bv - (\Div\bu) q - \rhoi \bg \cdot \bv\,d\bx = 0 \label{eq:glenstokesweak}
\end{equation}
for all $(\bv,q) \in \mathcal{M}_{\text{GS}}$; as before the effective viscosity $\nu_\eps$ is defined by \eqref{eq:regeffvisc}.  Jouvet and Rappaz \cite{JouvetRappaz2011} have proven that this formulation is well-posed if $\Lambda$ is bounded, the Neumann boundary is $C^1$, and the Dirichlet boundary is nonempty.  In particular they show \eqref{eq:glenstokesweak} is equivalent to minimization of a coercive functional over the divergence-free subspace, but also that there is a unique pressure $p\in L^\qq(\Lambda)$ as stated.

Going beyond predetermined ice geometry, we are interested in finding a triple $s,\bu,p$ which solves the weak form of \eqref{eq:strongform}, where $s$ is the surface elevation.  Suppose $\Omega \subset \RR^d$ is the map-plane domain, and suppose the bed elevation $b$ is in $C^1(\overline{\Omega}) \subset W^{1,\qq}(\Omega)$.  Let
\begin{equation}
\mathcal{K} = \{s \in W^{1,\qq}(\Omega) \,:\, s \ge b \, \text{ and } \, s\big|_{\partial\Omega} = b\big|_{\partial\Omega}\}  \label{eq:Kconstraintset}
\end{equation}
be the set of admissible surface elevations of our isolated glacier or ice sheet.  This set is closed and convex.  As noted earlier it is not clear that the correct Sobolev space is identified here, but we do need $s$ to have a well-behaved gradient in an integral sense.  In fact we suppose when needed that
\begin{equation}
s\in \mathcal{K} \text{ defines an icy domain } \Lambda_s \text{ which has piecewise-$C^1$ boundary.} \label{eq:quixotic}
\end{equation}
This quixotic assumption connects the known theory of shallow ice sheet well-posedness \cite{JouvetBueler2012}, which motivates definition \eqref{eq:Kconstraintset}, to the widely-used numerical construction of evolving ice sheet geometries from Glen-Stokes dynamics \cite{Jouvetetal2008,Lengetal2012}.  Assumption \eqref{eq:quixotic} would follow from a sufficiently strong regularity result for the theory presented in the current paper, which we certainly cannot offer, and subject to the no-overhangs hypothesis which might follow from the inclusion of non-fluid fracture processes (previous section).

Now, if $\partial \Lambda$ is piecewise $C^1$ then the Sobolev space $W^{1,\pp}(\Lambda)$ supports a well-defined linear trace operator $T(f) = f|_{\partial \Lambda}$ on spaces $T:W^{1,\pp}(\Lambda) \to L^\pp(\partial \Lambda)$ \cite[Section 5.5]{Evans2010}.  With this trace in mind, and noting that the upper ice surface $\overline{\partial} \Lambda_s$ is the Neumann boundary, we define the ice dynamics operator (IDO), a fundamental concept for our work (Figure \ref{fig:idoaction}).  For each surface elevation function $s \in \mathcal{K}$ we define the IDO value $\Phi(s) \in L^\pp(\Omega)$ as the upper-surface trace of the unique velocity solution $\bu$ of \eqref{eq:glenstokesweak} over the icy domain $\Lambda_s$, extended by zero, as in \eqref{eq:surfacevelocity}, to all of $\Omega$:
\begin{equation}
\Phi(s) = \begin{cases} \bu\big|_{\overline{\partial} \Lambda_s} & s(x,y) > b(x,y), \\
                        \bzero & \text{otherwise}. \end{cases} \label{eq:ido}
\end{equation}
Note that we are un-concerned that the vector field $\Phi(s)$ may have a jump at the glacier margin; we only expect $\Phi(s) \in L^\pp(\Omega)$.

\begin{figure}[t]
\begin{center}
\includegraphics[width=\textwidth]{genfigs/idoaction.pdf}
\end{center}
\caption{The ice dynamics operator $\Phi$ maps the surface elevation $s$ to the ice surface velocity $\Phi(s)=\bu|_s$.  Both input and output are defined on all of $\Omega$.}
\label{fig:idoaction}
\end{figure}

Using the IDO, and recalling that the CMB $a$ and the surface normal $\bn_s$ are defined on all of $\Omega$, we may re-write the strong form \eqref{eq:strongform} with the Glen-Stokes dynamics problem hidden:
\begin{align}
s - b &\ge 0  \label{eq:idostrongform} \\
- \Phi(s) \cdot \bn_s - a &\ge 0 \notag \\
(s - b) (- \Phi(s) \cdot \bn_s - a) &= 0 \notag
\end{align}
Here the statements hold on all of $\Omega$, the data $a,b$ are clear, and the apparent solution is the steady geometry $z=s(x,y)$ of the glacier, but of course the velocity and pressure $\bu,p$ are hidden in the dynamical computation of $\Phi(s)$.  It remains to write NCP \eqref{eq:idostrongform} in weak form, to achieve our goal in this section.

For $s \in \mathcal{K}$ and $r \in W^{1,\qq}(\Omega)$ we define a functional which is nonlinear in $s$:
\begin{equation}
F(s)[r] = \int_\Omega (- \Phi(s) \cdot \bn_s - a)\, r \,dx dy. \label{eq:sigpfunctional}
\end{equation}
That is, we compute $F(s)[r]$ by defining the icy domain $\Lambda_s$ as in \eqref{eq:lambdas}, then solving the (weak form) Glen-Stokes problem \eqref{eq:glenstokesweak}, then evaluating the surface trace of the velocity to compute the IDO \eqref{eq:ido}, and then integrating against the test function $r$.  Implicit in formula \eqref{eq:sigpfunctional} is the assumption that $- \Phi(s) \cdot \bn_s - a$ is sufficiently regular to be in the dual space of $W^{1,\qq}(\Omega)$; that is, a fair amount of singularity is allowed for this kinematical quantity.

The SIGP weak form is a variational inequality (VI) \cite{KinderlehrerStampacchia1980} which should determine $s\in\mathcal{K}$:
\begin{equation}
F(s)[r - s] \ge 0 \quad \text{for all $r \in \mathcal{K}$.}  \label{eq:sigpweakform}
\end{equation}

VI \eqref{eq:sigpweakform} has a shallow (i.e.~SIA) analog for which existence has been proven \cite{JouvetBueler2012}.  However, in the SIA theory the value of the functional can be computed by a local integral over powers of the thickness $s-b$ and the surface slope $\grad s$.  Here the computation of $F$ in \eqref{eq:sigpfunctional} is non-local and highly nontrivial; to evaluate $F(s)[r]$ one must solve the Glen-Stokes problem for the geometry from $s$ before integrating over $\Omega$.  In this sense we solve two coupled variational problems, weak forms \eqref{eq:glenstokesweak} and \eqref{eq:sigpweakform}, subject to the inequality-constraint that the surface elevation solution must be admissible ($s \in \mathcal{K}$).  The problem is copiously nonlinear because of the inequality constraint and the power-law rheology.

In both the SIA case and the current Glen-Stokes case, to the best of our knowledge, the VI does \emph{not} arise as a constrained minimization.  (The known exception is in the flat-bed SIA case \cite{JouvetBueler2012}.)  Of course the fixed-geometry Glen-Stokes problem \eqref{eq:glenstokesweak} does have such a (equality-constrained) minimization formulation \cite{Elmanetal2014,JouvetRappaz2011}.

To understand VI \eqref{eq:sigpweakform} one may, however, think by analogy to minimization over a convex set.  That is, conceptually-speaking, one might regard \eqref{eq:sigpfunctional} as a dual pairing of $F(s)$ and $r$, similar to an inner product, so that VI \eqref{eq:sigpweakform} says that $s$ is located in the closed and convex set $\mathcal{K}$, generically on $\partial\mathcal{K}$, where the gradient-like vector $F(s)$ points directly into $\mathcal{K}$; the ``angle'' between $F(s)$ and an arbitrary vector based at $s$ and pointing into $\mathcal{K}$, i.e.~$r-s$, is at most $90^\circ$.


\section{Functional derivatives} \label{sec:deriv}

In order to numerically solve \eqref{eq:sigpweakform}, as done in the remainder of this paper, we need to compute (Gateaux) derivatives of the IDO $\Phi$ in \eqref{eq:ido} and the functional $F$ in \eqref{eq:sigpfunctional}.  As we will see in this section, the efficient computation of these derivatives also involves an important approximation.

First, for $s \in \mathcal{K}$ and certain $t \in W^{1,\qq}(\Omega)$ let
\begin{equation}
\Phi'(s,t) = \lim_{\eps\to 0^+} \frac{\Phi(s+\eps t) - \Phi(s)}{\eps} = \lim_{\eps\to 0^+} \frac{\bu|_{s+\eps t} - \bus}{\eps}. \label{eq:idoderiv}
\end{equation}
Note that two Glen-Stokes solutions are implied to compute the difference quotient, namely over the ice domains $\Lambda_{s+\eps t}$ and $\Lambda_s$; from the solutions we extract the surface velocity and extend by zero.  In fact \eqref{eq:idoderiv} is only valid if $s+\eps t \in \mathcal{K}$ for sufficiently-small $\eps>0$, i.e.~subject to the one-sided constraint $s+\eps t \ge b$, which is a requirement on the sign of $t$ in ice-free areas.  Clearly it suffices that $t \ge 0$ so let
\begin{equation}
\mathcal{D}^+ = \{t \in W^{1,\qq}(\Omega) \,:\, t(x,y) \ge 0\}. \label{eq:infdefectset}
\end{equation}
Then $\Phi'$ is a well-defined function from $\mathcal{K} \times \mathcal{D}^+$ to a space of low regularity such that the integrals needed to compute the derivative of $F$, as follows, are valid.

To compute the derivative of $F$ from \eqref{eq:surfacenormal} and \eqref{eq:sigpfunctional}, consider the difference
\begin{align*}
F(s+\eps t)[r] - F(s)[r] &= \int_\Omega \Big(\Phi(s+\eps t) \cdot \left<s_x+\eps t_x,s_y+\eps t_y,-1\right> - \Phi(s) \cdot \left<s_x,s_y,-1\right>\Big)\, r \,dx dy \\
    &= \eps \int_\Omega \big(-\Phi'(s,t) \cdot \bn_s + \Phi(s) \cdot \left<t_x,t_y,0\right>\big)\, r \,dx dy + O(\eps^2).
\end{align*}
It follows that for $s\in \mathcal{K}$, $t\in \mathcal{D}^+$, and $r \in W^{1,\qq}(\Omega)$ we have
\begin{align}
F'(s,t)[r] &= \lim_{\eps\to 0^+} \frac{F(s+\eps t)[r] - F(s)[r]}{\eps}  \label{eq:sigpfunctionalderiv} \\
    &= \int_\Omega \big(-\Phi'(s,t) \cdot \bn_s + \Phi(s) \cdot \left<t_x,t_y,0\right>\big)\, r \,dx dy. \notag
\end{align}
Evidently, $F'$ is straightforward to compute once we have $\Phi'$ in hand.

\section{Multilevel constraint decomposition} \label{sec:mcdstokes}

FIXME smoother uses Firedrake \cite{Alnaesetal2014,Rathgeberetal2016} with extruded meshes \cite{Gibsonetal2019,McRaeetal2016} and PETSc \cite{Balayetal2020,Bueler2021} to solve the dynamics problem and thereby evaluate the residual, and Stokeslets for Jacobian

FIXME in this paper the Glen-Stokes problem is solved by Newton linearization and (parallel) direct solution of the Newton step equations; however, geometric multigrid is available already for Glen-Stokes dynamics \cite{IsaacStadlerGhattas2015}; see also \cite{BrownSmithAhmadia2013} and \cite{Tuminaroetal2016} which solve a first-order approximation of the Glen-Stokes ice sheet problem by geometric and algebraic multigrid, respectively


\section{Multilevel methods for evolving geometry} \label{sec:stokesevolution}

FIXME time-dependent runs


\section*{Acknowledgments}  Thanks to David Maxwell for suggestions on the formulation and well-posedness of the model.

\small

\bigskip
\bibliography{partII}
\bibliographystyle{siam}

\appendix

\section{Glossary of acronyms} \label{app:glossary}

\renewcommand{\arraystretch}{1.1}
\begin{longtable}{l|ll}
\toprule
\textbf{Acronym} {\Large$\strut$} & \textbf{Definition} & \textbf{Reference} \\ \hline
CMB & climatic mass balance & Section \ref{sec:stokesgeometry} \\
FE & finite element & Section \ref{sec:mcdstokes} \\
IDO & ice dynamics operator & Section \ref{sec:stokesgeometry}, eqn.~\eqref{eq:ido} \\
IIGP & implicit ice geometry problem & Section \ref{sec:stokesevolution} \\
MCD & multilevel constraint decomposition & Section \ref{sec:mcdstokes} \\
NCP & nonlinear complementarity problem & Section \ref{sec:stokesgeometry} \\
SIA & shallow ice approximation & Section \ref{sec:intro} \\
SIGP & steady ice geometry problem & Section \ref{sec:stokesgeometry}, eqn.~\eqref{eq:strongform} \\
SKE & surface kinematical equation & Section \ref{sec:stokesgeometry}, eqn.~\eqref{eq:ske} \\
VI & variational inequality & Section \ref{sec:stokesgeometry} \\
WU & work units & Section \ref{sec:mcdstokes} \\ % final \\ required
\bottomrule
\caption{Glossary of acronyms used in this paper.}
\label{tab:acronyms}
\end{longtable}

\end{document}
