\documentclass[letterpaper,final,12pt,reqno]{amsart}

\usepackage[total={6.3in,9.2in},top=1.1in,left=1.1in]{geometry}

\usepackage{times,bm,bbm,empheq,fancyvrb,graphicx}
\usepackage[dvipsnames]{xcolor}
\usepackage{longtable}
\usepackage{booktabs}

\usepackage{tikz}
\usetikzlibrary{decorations.pathreplacing}

\usepackage[kw]{pseudo}
\pseudoset{left-margin=15mm,topsep=5mm,idfont=\texttt}

% hyperref should be the last package we load
\usepackage[pdftex,
colorlinks=true,
plainpages=false, % only if colorlinks=true
linkcolor=blue,   % ...
citecolor=Red,    % ...
urlcolor=black    % ...
]{hyperref}

\renewcommand{\baselinestretch}{1.05}

\newtheoremstyle{claim}% name
  {5pt}% space above
  {5pt}% space below
  {\itshape}% body font
  {}% indent amount
  {\itshape}% theorem head font
  {.}% punctuation after theorem head
  {.5em}% space after theorem head
  {\thmname{#1}\thmnumber{ #2}\thmnote{ (#3)}}% theorem head spec
\theoremstyle{claim}
\newtheorem{theorem}{Theorem}
\newtheorem{lemma}{Lemma}

\newcommand{\eps}{\epsilon}
\newcommand{\RR}{\mathbb{R}}

\newcommand{\grad}{\nabla}
\newcommand{\Div}{\nabla\cdot}
\newcommand{\trace}{\operatorname{tr}}

\newcommand{\hbn}{\hat{\mathbf{n}}}

\newcommand{\bb}{\mathbf{b}}
\newcommand{\be}{\mathbf{e}}
\newcommand{\bbf}{\mathbf{f}}
\newcommand{\bg}{\mathbf{g}}
\newcommand{\bn}{\mathbf{n}}
\newcommand{\br}{\mathbf{r}}
\newcommand{\bu}{\mathbf{u}}
\newcommand{\bv}{\mathbf{v}}
\newcommand{\bw}{\mathbf{w}}
\newcommand{\bx}{\mathbf{x}}

\newcommand{\bF}{\mathbf{F}}
\newcommand{\bV}{\mathbf{V}}
\newcommand{\bX}{\mathbf{X}}

\newcommand{\bxi}{\bm{\xi}}

\newcommand{\bzero}{\bm{0}}

\newcommand{\rhoi}{\rho_{\text{i}}}

\newcommand{\ip}[2]{\left<#1,#2\right>}

\newcommand{\mR}{R^{\bm{\oplus}}}
\newcommand{\iR}{R^{\bullet}}

\newcommand{\pp}{{\text{p}}}
\newcommand{\qq}{{\text{q}}}
\newcommand{\rr}{{\text{r}}}

% numbering
\setcounter{tocdepth}{3}
\makeatletter
\def\l@subsection{\@tocline{2}{0pt}{4pc}{5pc}{}}
\makeatother

\numberwithin{equation}{section}
\numberwithin{figure}{section}
\numberwithin{table}{section}
\numberwithin{theorem}{section}


\begin{document}
\title[Geometric multigrid for glacier modeling II]{Geometric multigrid for glacier modeling II: \\ Glacier geometry from Stokes dynamics}

\author{Ed Bueler}

\author{David Maxwell}

\author{Lawrence Mitchell}

\begin{abstract} FIXME MCD for steady and evolving geometry with Glen-Stokes dynamics; Schur-complement or Vanka Newton-multigrid for the dynamics problem
\end{abstract}

\maketitle

\tableofcontents

\thispagestyle{empty}
%\bigskip

\section{Introduction} \label{sec:intro}

FIXME MCD = multilevel constraint decomposition, a multigrid \cite{Trottenbergetal2001} method basically by \cite{Tai2003} for obstacle problems; see part I \cite{Bueler2022partI};  obstacle problem view first extended to Stokes by \cite{WirbelJarosch2020}


\section{The Stokes geometry problem} \label{sec:stokesgeometry}

The standard model for determining the geometry of glaciers is based upon a shear-thinning version of the Stokes equations, namely the Glen-Stokes model which we describe in this section, plus the surface kinematical equation (SKE).  We first state the strong form for this ``coupled'' glacier geometry model in the steady-state case.  The emphasis here is on the complementarity-problem context of the SKE, which is in contrast with the standard literature, a contrast observed by \cite{SchoofHewitt2013}, for example.  We then describe two different understandings of the weak form for this steady coupled model, noting along the way some the theoretical incompleteness of this standard coupled model.  One of the weak forms serves as a starting point for the multilevel method in the next section.  Lastly in this section we extend the steady weak form to an implicit time-discretized  evolving-geometry model, a straightforward extension.

We state the steady-state model on a fixed map-plane region $\Omega \subset \RR^d$ (Figure \ref{fig:stokesdomain}) with map-plane variables $x$ or $(x,y)$, respectively, when $d=1$ or $d=2$.  On $\Omega$ we assume that a climatic mass balance (CMB) function $a(x,y)$ is defined at every point, whether or not ice is present at that location, with units of ice thickness per time.  Similarly we assume there is a bed elevation function $b(x,y)$ defined everywhere on $\Omega$.  The functions $a$ and $b$ are the data of the steady geometry problem.

\begin{figure}[ht]
\begin{center}
\includegraphics[width=0.75\textwidth]{genfigs/stokesdomain.pdf}
\end{center}
\caption{The CMB $a(x,y)$ (arrows) and bed elevation $b(x,y)$ (solid) are given data on a fixed $d$-dimensional map-plane region $\Omega$.  The solution geometry defines a surface elevation $s(x,y)$ (dashed) on $\Omega$ and a $(d+1)$-dimensional icy domain $\Lambda_s = \{b(x,y) < z < s(x,y)\}$; note $s=b$ where ice-free.}
\label{fig:stokesdomain}
\end{figure}

The stress balance for ice clearly only applies in the interior of the icy domain.  We make a strong, but common \cite[for example]{IsaacStadlerGhattas2015,Jouvetetal2008,Lengetal2012,WirbelJarosch2020} assumption about the icy domain, namely that the upper surface elevation of the ice is well-defined as a function $s(x,y)$, that is, we \emph{assume there are no overhangs}.  We then define $s$ everywhere in $\Omega$ by extending with $s=b$ where ice is absent, thus $s\ge b$ applies on $\Omega$.  Note that $s(x,y)$ is part of the \emph{solution} of our model.

The model we describe here is likely not to be well-posed at the ice margin.  That is, there may be no steady state of the fluid geometry in the vicinity of a steep ice margin, especially on a steep bed feature.  The same concern applies to each time step of an evolving model in the sense that overhanging ice may appear at the margin, violating the well-defined-$s(x,y)$ assumption.  However, essentially all modeling literature ignors this possibility and assumes well-defined surface elevation and thickness.  An exception is in \cite{PralongFunk2005}, which also suggests an extended continuum model which may be well-posed, namely in which serac and ice-cliff calving occurs via a damage variable and a stress-fracture failure criterion.  This model, which we do not pursue, is relevant to interpretating our numerical boundary construction, which implies a short cliff, in Section \ref{sec:mcdstokes}.

Based on this assumption of a well-defined upper surface, the $(d+1)$-dimensional extent of the ice, also part of the solution, is the (open) domain
\begin{equation}
\Lambda_s = \{(x,y,z)\,|\,(x,y) \in \Omega \text{ and } b(x,y) < z < s(x,y)\} \label{eq:lambdas}
\end{equation}
where $z$ is vertically-upward.  (If $d=1$ then the coordinates on $\Lambda_s$ are denoted $(x,z)$.)

The dynamics of glaciers is based upon an assumption that ice is a very-viscous non-Newtonian fluid subject to Glen's shear-thinning flow law \cite{GreveBlatter2009}.  Allowing any Glen exponent $n\ge 1$, the equations \cite[Chapter 1]{FowlerNg2021} for bulk ice are:
\begin{align}
- \nabla \cdot \tau + \nabla p &= \rhoi \bg &&\text{\emph{stress balance}} \label{eq:forcebalance} \\
\nabla \cdot \bu &= 0 &&\text{\emph{incompressibility}} \label{eq:incompressible} \\
\tau &= B_n |D\bu|^{(1/n) - 1} D\bu  &&\text{\emph{flow law}} \label{eq:viscflowlaw}
\end{align}
Solution fields, defined on $\Lambda_s$, are the velocity $\bu$, pressure $p$, and the deviatoric stress tensor $\tau$.  In later computations we will use $n=3$, ice density $\rhoi=910 \,\text{kg}\,\text{m}^{-3}$, and gravity $\bg=\left<0,0,-g\right>$, with $g=9.81\,\text{m}\,\text{s}^{-2}$.  Also $B_n$ is the ($n$-dependent) ice hardness, a constant because we assume isothermal conditions; $B_n=6.8082\times 10^7\,\text{Pa}\,\text{s}^{1/3}$ is used in computations.

Regarding tensors and their notation, the full (Cauchy) stress tensor $\sigma$ \cite{GreveBlatter2009} decomposes into the deviatoric part $\tau$ minus the pressure, i.e.~$\sigma = \tau - p\,I$, so equation \eqref{eq:forcebalance} simply says $-\Div \sigma = \rhoi \bg$.  The strain rate tensor $D\bu$ is the symmetric part of $\grad \bu$: \,$(D\bu)_{ij} = \frac{1}{2} \left(\grad\bu + \grad\bu^\top\right)$.  Because $D\bu$ is symmetric, and because it has trace zero by equation \eqref{eq:incompressible}, i.e.~$\trace(D\bu)=\nabla \cdot \bu = 0$, from equation \eqref{eq:viscflowlaw} it follows that $\tau$ is also symmetric with trace zero.  The tensor norm in \eqref{eq:viscflowlaw} satisfies $|D\bu|^2 = \frac{1}{2} \trace\left((D\bu)^2\right) = \frac{1}{2} (D\bu)_{ij} (D\bu)_{ij}$.

For the $n=1$ linear Stokes equations \cite{Elmanetal2014} one traditionally writes \eqref{eq:viscflowlaw} as $\tau = 2\nu D\bu$ with viscosity $\nu = (1/2) B_1$.  For powers $n>1$, namely shear-thinning ice we define an ``effective viscosity'' using a negative power of the strain rate norm $|D\bu|$.  This effective viscosity would be singular in the limit of small strain rates, and so, motivated by the actual finite viscosity of glacier ice \cite{GreveBlatter2009}, we define the regularized effective viscosity
\begin{equation}
\nu_\eps = \frac{1}{2} B_n \left(|D\bu|^2 + \eps\, D_0^2\right)^{(\pp-2)/2}, \label{eq:regeffvisc}
\end{equation}
where $\pp=(1/n)+1=4/3$.  The constant $D_0$ defines a strain-rate scale for glacier flow; $D_0 = 1 \,\text{a}^{-1}$ and $\eps = 10^{-4}$ (pure) are used in computations.  Using \eqref{eq:regeffvisc} we may eliminate $\tau$ and rewrite \eqref{eq:forcebalance} as $- \nabla \cdot \left(2 \nu_\eps\, D\bu\right) + \nabla p = \rhoi \mathbf{g}$.

Dynamic boundary conditions for the isolated, grounded, and non-sliding case are used in this paper.  The ice surfaces are well-defined functions, thus the top and bottom boundaries of $\Lambda_s$ can be identified, and we assume these surfaces have well-defined tangents.  On top we set a condition of zero applied stress,
\begin{equation}
\left(2 \nu_\eps D\bu - pI\right) \bn_s = \bzero  \qquad \qquad \text{\emph{on the top} } \overline{\partial} \Lambda_s, \label{eq:topbc}
\end{equation}
where $\bn_s$ is the (upward, non-normalized) normal to the ice surface.  (It is straightforward to provide a nonzero atmospheric pressure at the surface.)  On the base we require no slip:
\begin{equation}
\bu = \bzero  \qquad\qquad \text{\emph{on the base} } \underline{\partial} \Lambda_s. \label{eq:basebc}
\end{equation}
The ice flow extends in the horizontal direction until a free boundary at the glacier margin is reached, and at such locations the surface gradient $\grad s$ becomes singular.  (Real glacier margins may occur as fracture-generated cliffs, but such non-fluid processes are not modeled here.)

On the assumption that the ice geometry $\Lambda_s$ is known, the well-posedness of the above model is proven by \cite{JouvetRappaz2011}, and the solution is a unique pair $(\bu,p)$ defined on $\Lambda_s$.  However, the simultaneous determination of the ice geometry and its flow is our goal.  Observing that the above equations make no reference to the CMB function $a$, it remains to couple the climate to the dynamics so as to determine the glacier geometry from the given data.

Noting that the surface elevation is already defined on all of $\Omega$, with $s=b$ off the ice, we also extend the surface normal $\bn_s$, thus formula
\begin{equation}
\bn_s = \left<-s_x,-s_y,1\right> \label{eq:surfacenormal}
\end{equation}
is valid on all of $\Omega$.  (Note, however, that dynamical boundary condition \eqref{eq:topbc} applies only where ice is present.)  Furthermore we extend the surface value of the velocity to all of $\Omega$:
\newcommand{\us}{\bu|_s}
\begin{equation}
\bu|_s = \begin{cases} \bu(x,y,s(x,y)), & s(x,y) > b(x,y), \\
                       \bzero, & \text{elsewhere}. \end{cases} \label{eq:surfacevelocity}
\end{equation}
(The movement of the solid earth implies $\us\ne 0$ everywhere, but we ignore this small effect.)

With the above conventions we can state the remaining equation in the model which determines the geometry, namely the steady-state surface kinematical equation (SKE) \cite{GreveBlatter2009}, an aspect of mass conservation:
\begin{equation}
\bu|_s \cdot \bn_s + a = 0 \qquad \text{\emph{on the ice}}. \label{eq:ske}
\end{equation}
The quantities in this equation are defined everywhere but the kinematical quantity $\bu|_s \cdot \bn_s + a$ is only zero on the ice.  With convention \eqref{eq:surfacevelocity}, extending the surface velocity by zero off the ice, $\bu|_s \cdot \bn_s + a \le 0$ everywhere because $a$ is negative off the ice in steady state.  In fact, as observed in part I of this paper \cite{Bueler2022partI} (see also \cite{Bueler2021conservation}), the SKE is part of a nonlinear complementarity problem (NCP) when combined with the constraint that $s\ge b$ everywhere on $\Omega$.

This leads us to state a strong form of the steady geometry model as follows:
\begin{align}
s - b &\ge 0 && \text{on $\Omega$} \label{eq:strongform} \\
- \bu|_s \cdot \bn_s - a &\ge 0 \notag \\
(s - b) (- \bu|_s \cdot \bn_s - a) &= 0 \notag \\
- \nabla \cdot \left(2 \nu_\eps\, D\bu\right) + \nabla p - \rhoi \mathbf{g} &= \bzero && \text{on $\Lambda_s$} \notag \\
\nabla \cdot \bu &= 0 \notag \\
\left(2 \nu_\eps D\bu - pI\right) \bn_s &= \bzero && \text{on $\overline{\partial} \Lambda_s$} \notag \\
\bu &= \bzero && \text{on $\underline{\partial} \Lambda_s$} \notag
\end{align}
along with definition \eqref{eq:regeffvisc}.  The first three statements form an NCP, but they are only fully-defined by using the boundary value problem for the dynamics, namely the last four statements.  The solution is a triple of functions $s(x,y)$, $\bu(x,y,z)$, $p(x,y,z)$, but, as the domain $\Lambda_s$ on which $\bu,p$ are defined is only known simultaneously with the solution elevation $s$, system \eqref{eq:strongform} is at least an incomplete description.  (The weak form stated below will address this concern.)

The inequality-constrained system of PDEs \eqref{eq:strongform} has a largely-unknown theory regarding well-posedness and solution regularity.  Nonetheless we will write it next in different weak forms, identifying reasonable function spaces and making solution existence credible.  Note that some well-posedness theory is known for the shallow ice approximation (SIA) version of this problem; existence is established by \cite{JouvetBueler2012}, with uniqueness in the flat bed case.  The direct solution of \eqref{eq:strongform} has (mostly; see \cite{WirbelJarosch2020}) not been attempted by existing ice sheet and glacier models; they use an explicit time-stepping approach to steady state, splitting the dynamics and the SKE into separate steps \cite[for example]{Jouvetetal2008,Lengetal2012}.  In any case, in the next section we will demonstrate a reasonably-robust multilevel scheme for its direct numerical solution.

Recall that the weak form of a PDE model states that the solution is the zero of a certain functional which is constructed by multiplying by a test function and integrating by parts.  Both the solution and the test functions come from identified function spaces, namely Sobolev spaces \cite{Evans2010}.  (We denote by $W^{k,r}$ the Sobolev space of functions which have $k$ derivatives which are $r$th-power integrable.)

For example, it is well-known \cite[for example]{Elmanetal2014} that for a fixed domain $\Lambda \subset \RR^3$, on which a constant-viscosity ($\nu_0$) and zero body force, linear Stokes model applies, with a Dirichlet condition on part of the domain and stress-free conditions otherwise, the weak form is the statement that $(\bu,p) \in W_0^{1,2}(\Lambda)^3 \times L^2(\Lambda)$ satisfies
\begin{equation}
\int_\Lambda 2 \nu_0 D\bu : D\bv - p \Div\bv - q \Div\bu\,d\bx = 0 \quad \text{for all } (\bv,q) \in W_0^{1,2}(\Lambda)^3 \times L^2(\Lambda).  \label{eq:linearstokesweak}
\end{equation}

As shown by Poisson and SIA examples in part I \cite{Bueler2022partI}, a similar construction generates the weak form of an inequality-constrained model as a variational inequality (VI) \cite{KinderlehrerStampacchia1980}.  Recall $\pp=(1/n)+1=4/3$ from the SIA model example, and let $\qq=(1-\pp^{-1})^{-1}=n+1=4$ be the conjugate exponent, so that $\pp^{-1}+\qq^{-1}=1$.  Suppose $b$ has bounded derivatives and let
\begin{equation}
\mathcal{K} = \{s \in W_0^{1,\qq}(\Omega) \,|\, s \ge b\}.  \label{eq:Kconstraintset}
\end{equation}
This is the constraint set for surface elevations, the same as in the discussion of the SIA model.

Next we construct two such weak forms for the coupled, steady Stokes-based glacier geometry model \eqref{eq:strongform}.  Each one combines the VI for the surface elevation with a nonlinear version of the Stokes weak form \eqref{eq:linearstokesweak}.

Let $z^+ \in \RR$ be a value which is larger than any expected value of $s(x,y)$.  Then
\begin{equation}
\Xi = \{(x,y,z)\,|\, (x,y) \in \Omega, b(x,y) < z < z^+\} \subset \RR^{d+1}  \label{eq:Xi}
\end{equation}
is a fixed and bounded domain which contains the glacier as a subset.  Let
\begin{equation}
\mathcal{V} = W_0^{1,\pp}(\Xi)^{d+1}
\end{equation}
be a set of velocity fields $\bv$ which satisfy $\bv=0$ on the bottom boundary of $\Xi$.  Now let
\begin{equation}
\mathcal{W} = \mathcal{K} \times \mathcal{V} \times L^\qq(\Xi)  \label{eq:Wset}
\end{equation}
be the set of admissible solution triples $(s,\bu,p)$, and let $\tilde{\mathcal{W}} = W_0^{1,\qq}(\Omega) \times \mathcal{V} \times L^\qq(\Xi)$ be the corresponding vector space; note $\mathcal{W}$ is a closed and convex subset of $\tilde{\mathcal{W}}$.  Finally define a function on $\RR^3$ which we will use to create the characteristic function of the icy domain $\Lambda_s$:
\begin{equation}
\Phi(z,\beta,\zeta) = \begin{cases} 1, & \beta < z < \zeta, \\ 0, & \text{otherwise}.  \end{cases}
\end{equation}
Note that if we are given a solution surface elevation $s(x,y)$ then
    $$\Phi(z,b(x,y),s(x,y)) = 1 \quad \iff \quad (x,y,z) \in \Lambda_s.$$

From the above components we define a functional $\tilde F : \mathcal{W} \times \tilde{\mathcal{W}} \to \RR$ which is (extremely) nonlinear in the first triple $(s,\bu,p) \in \mathcal{W}$ but linear in the second triple:
\begin{align}
\tilde F(s,\bu,p;r,\bv,q) &= \int_\Omega (-\bn_s \cdot \bu|_s - a) r \,dx dy \\
   &\quad + \int_\Xi \Phi(z,b,s) \Big[2 \nu_\eps D\bu : D\bv - p \Div\bv - q \Div\bu - \rhoi \bg \bv\Big]\,d\bx \notag
\end{align}
where \eqref{eq:regeffvisc} defines $\nu_\eps = \nu_\eps(|D\bu|)$.  Then our first weak form for model \eqref{eq:strongform} is the VI statement that $(s,\bu,p) \in \mathcal{W}$ satisfies
\begin{equation}
\tilde F(s,\bu,p;r-s,\bv-\bu,q-p) \ge 0 \quad \text{for all } (r,\bv,q) \in \mathcal{W}.\label{eq:firstweak}
\end{equation}
Three key observations should be made about \eqref{eq:firstweak}:
\renewcommand{\labelenumi}{\emph{(\roman{enumi})}}
\begin{enumerate}
\item the integrals defining $\tilde F$ are over fixed, solution-independent sets $\Omega$, $\Xi$,
\item the coefficient $\Phi(z,b,s)$ depends on the solution, namely $s$, and
\item while $\bu,p$ are defined on $\Xi$ if $(s,\bu,p) \in \mathcal{W}$, in fact $\tilde F$ is insensitive to values of $\bu,p$ outside of $\Lambda_s$.
\end{enumerate}
Observation \emph{(iii)} says that $\tilde F$ is not coercive \cite{KinderlehrerStampacchia1980} on $\mathcal{W}$.

FIXME SECOND WEAK FORM IS LESS HARD ASS

\section{Multilevel constraint decomposition (MCD) for steady Stokes geometry} \label{sec:mcdstokes}

FIXME smoother uses Firedrake \cite{Alnaesetal2014,Rathgeberetal2016} with extruded meshes \cite{Gibsonetal2019,McRaeetal2016} and PETSc \cite{Balayetal2020,Bueler2021} to solve the dynamics problem and thereby evaluate the residual, and Stokeslets for Jacobian

\section{Multigrid for the (fixed-geometry) Stokes dynamics problem} \label{sec:stokesdynamics}

FIXME multigrid already used for Blatter-Pattyn dynamics \cite{BrownSmithAhmadia2013}; for hybrid dynamics \cite{Jouvetetal2013,JouvetGraeser2013}; and for Stokes dynamics \cite{IsaacStadlerGhattas2015} and \cite{Tuminaroetal2016} using AMG

FIXME we use Schur complement \cite{Bueler2021,Elmanetal2014} and compare it to Vanka monolithic smoother \cite{Farrelletal2019}

\section{Multilevel methods for evolving geometry} \label{sec:stokesevolution}

FIXME time-dependent runs

\small

\bigskip
\bibliography{partII}
\bibliographystyle{siam}

\end{document}
